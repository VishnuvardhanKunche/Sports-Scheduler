<%- include('../partials/header') %>

<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>
        <i class="fas fa-tachometer-alt me-2"></i>
        My Dashboard
    </h1>
    <a href="/sessions/new" class="btn btn-primary">
        <i class="fas fa-plus me-2"></i>
        Create New Session
    </a>
</div>

<!-- Quick Actions -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card bg-primary text-white">
            <div class="card-body text-center">
                <i class="fas fa-plus fa-2x mb-2"></i>
                <h6>Create Session</h6>
                <a href="/sessions/new" class="btn btn-light btn-sm">Go</a>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-success text-white">
            <div class="card-body text-center">
                <i class="fas fa-search fa-2x mb-2"></i>
                <h6>Browse Sessions</h6>
                <a href="/player/sessions" class="btn btn-light btn-sm">Go</a>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-info text-white">
            <div class="card-body text-center">
                <i class="fas fa-futbol fa-2x mb-2"></i>
                <h6>All Sports</h6>
                <a href="/sports" class="btn btn-light btn-sm">Go</a>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-warning text-white">
            <div class="card-body text-center">
                <i class="fas fa-calendar fa-2x mb-2"></i>
                <h6>Created: <%= upcomingCreated.length %></h6>
                <h6>Joined: <%= upcomingJoined.length %></h6>
            </div>
        </div>
    </div>
</div>

<!-- Available Sessions to Join -->
<% if (availableSessions.length > 0) { %>
<div class="mb-5">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>
            <i class="fas fa-star me-2 text-warning"></i>
            Sessions You Can Join
        </h3>
        <a href="/player/sessions" class="btn btn-outline-primary">View All</a>
    </div>
    
    <div class="row">
        <% availableSessions.forEach(session => { %>
            <div class="col-md-6 col-lg-4 mb-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">
                            <i class="fas fa-futbol me-2 text-primary"></i>
                            <%= session.sport.name %>
                        </h5>
                        <p class="card-text">
                            <small class="text-muted">
                                <i class="fas fa-user me-1"></i>
                                <%= session.creator.name %>
                            </small>
                        </p>
                        <p class="card-text">
                            <i class="fas fa-calendar me-2"></i>
                            <%= new Date(session.date).toLocaleDateString() %>
                            <br>
                            <i class="fas fa-clock me-2"></i>
                            <%= session.time %>
                            <br>
                            <i class="fas fa-map-marker-alt me-2"></i>
                            <%= session.venue %>
                        </p>
                        <div class="d-flex justify-content-between align-items-center">
                            <small class="text-muted">
                                <%= session.players.length %>/<%= session.playersNeeded %> players
                            </small>
                            <div>
                                <a href="/sessions/<%= session.id %>" class="btn btn-sm btn-outline-primary me-1">
                                    View
                                </a>
                                <% if (session.players.length < session.playersNeeded) { %>
                                    <form action="/player/sessions/<%= session.id %>/join" method="POST" class="d-inline">
                                        <button type="submit" class="btn btn-sm btn-success">
                                            Join
                                        </button>
                                    </form>
                                <% } else { %>
                                    <button class="btn btn-sm btn-secondary" disabled>Full</button>
                                <% } %>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        <% }); %>
    </div>
</div>
<% } %>

<!-- My Sessions -->
<div class="row">
    <!-- Sessions I Created -->
    <div class="col-lg-6 mb-4">
        <h3>
            <i class="fas fa-user-tie me-2 text-primary"></i>
            Sessions I Created
        </h3>
        
        <% if (upcomingCreated.length > 0) { %>
            <h5 class="text-success mt-3">Upcoming</h5>
            <% upcomingCreated.forEach(session => { %>
                <div class="card mb-2">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="card-title mb-1">
                                    <%= session.sport.name %>
                                    <% if (session.status === 'cancelled') { %>
                                        <span class="badge bg-danger">Cancelled</span>
                                    <% } %>
                                </h6>
                                <small class="text-muted">
                                    <i class="fas fa-calendar me-1"></i>
                                    <%= new Date(session.date).toLocaleDateString() %> at <%= session.time %>
                                    <br>
                                    <i class="fas fa-map-marker-alt me-1"></i>
                                    <%= session.venue %>
                                    <br>
                                    <i class="fas fa-users me-1"></i>
                                    <%= session.players.length %>/<%= session.playersNeeded %> players
                                </small>
                            </div>
                            <div class="dropdown">
                                <button class="btn btn-sm btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown">
                                    Actions
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="/sessions/<%= session.id %>">View Details</a></li>
                                    <% if (session.status === 'active' && !session.isPast()) { %>
                                        <li><a class="dropdown-item" href="/sessions/<%= session.id %>/edit">Edit Session</a></li>
                                        <li><hr class="dropdown-divider"></li>
                                        <li><a class="dropdown-item text-danger" href="/sessions/<%= session.id %>/cancel">Cancel Session</a></li>
                                    <% } %>
                                </ul>
                            </div>
                        </div>
                        <% if (session.status === 'cancelled' && session.cancellationReason) { %>
                            <div class="alert alert-danger mt-2 mb-0 py-2">
                                <small><strong>Reason:</strong> <%= session.cancellationReason %></small>
                            </div>
                        <% } %>
                    </div>
                </div>
            <% }); %>
        <% } %>
        
        <% if (pastCreated.length > 0) { %>
            <h5 class="text-muted mt-4">Past Sessions</h5>
            <% pastCreated.slice(0, 3).forEach(session => { %>
                <div class="card mb-2 bg-light">
                    <div class="card-body py-2">
                        <h6 class="card-title mb-1">
                            <%= session.sport.name %>
                            <% if (session.status === 'cancelled') { %>
                                <span class="badge bg-secondary">Cancelled</span>
                            <% } else { %>
                                <span class="badge bg-success">Completed</span>
                            <% } %>
                        </h6>
                        <small class="text-muted">
                            <%= new Date(session.date).toLocaleDateString() %> • 
                            <%= session.players.length %>/<%= session.playersNeeded %> players
                        </small>
                    </div>
                </div>
            <% }); %>
        <% } %>
        
        <% if (upcomingCreated.length === 0 && pastCreated.length === 0) { %>
            <div class="text-center py-4 text-muted">
                <i class="fas fa-calendar-plus fa-3x mb-3"></i>
                <p>You haven't created any sessions yet.</p>
                <a href="/sessions/new" class="btn btn-primary">Create Your First Session</a>
            </div>
        <% } %>
    </div>

    <!-- Sessions I Joined -->
    <div class="col-lg-6 mb-4">
        <h3>
            <i class="fas fa-users me-2 text-success"></i>
            Sessions I Joined
        </h3>
        
        <% if (upcomingJoined.length > 0) { %>
            <h5 class="text-success mt-3">Upcoming</h5>
            <% upcomingJoined.forEach(session => { %>
                <div class="card mb-2">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="card-title mb-1">
                                    <%= session.sport.name %>
                                    <% if (session.status === 'cancelled') { %>
                                        <span class="badge bg-danger">Cancelled</span>
                                    <% } %>
                                </h6>
                                <small class="text-muted">
                                    <i class="fas fa-user me-1"></i>
                                    Organized by <%= session.creator.name %>
                                    <br>
                                    <i class="fas fa-calendar me-1"></i>
                                    <%= new Date(session.date).toLocaleDateString() %> at <%= session.time %>
                                    <br>
                                    <i class="fas fa-map-marker-alt me-1"></i>
                                    <%= session.venue %>
                                </small>
                            </div>
                            <div>
                                <a href="/sessions/<%= session.id %>" class="btn btn-sm btn-outline-primary">View</a>
                                <% if (session.status === 'active') { %>
                                    <form action="/player/sessions/<%= session.id %>/leave" method="POST" class="d-inline">
                                        <button type="submit" class="btn btn-sm btn-outline-danger" 
                                                data-confirm="Are you sure you want to leave this session?">
                                            Leave
                                        </button>
                                    </form>
                                <% } %>
                            </div>
                        </div>
                        <% if (session.status === 'cancelled' && session.cancellationReason) { %>
                            <div class="alert alert-warning mt-2 mb-0 py-2">
                                <small><strong>Cancelled:</strong> <%= session.cancellationReason %></small>
                            </div>
                        <% } %>
                    </div>
                </div>
            <% }); %>
        <% } %>
        
        <% if (pastJoined.length > 0) { %>
            <h5 class="text-muted mt-4">Past Sessions</h5>
            <% pastJoined.slice(0, 3).forEach(session => { %>
                <div class="card mb-2 bg-light">
                    <div class="card-body py-2">
                        <h6 class="card-title mb-1">
                            <%= session.sport.name %>
                            <span class="badge bg-success">Attended</span>
                        </h6>
                        <small class="text-muted">
                            <%= new Date(session.date).toLocaleDateString() %> • 
                            Organized by <%= session.creator.name %>
                        </small>
                    </div>
                </div>
            <% }); %>
        <% } %>
        
        <% if (upcomingJoined.length === 0 && pastJoined.length === 0) { %>
            <div class="text-center py-4 text-muted">
                <i class="fas fa-user-friends fa-3x mb-3"></i>
                <p>You haven't joined any sessions yet.</p>
                <a href="/player/sessions" class="btn btn-success">Browse Available Sessions</a>
            </div>
        <% } %>
    </div>
</div>

<%- include('../partials/footer') %>